import{u as le,A as ie}from"./business-BrTkWtTt.js";import{u as de,k as ce,K as ue,r as u,q as xe,m as P,x as pe,O as ge,c as i,o as n,g as b,d as A,a as e,p as x,t as d,z as D,h as c,F as E,y as S,n as me,A as B,i as H,S as fe}from"./index-Ficy73Kv.js";import be from"./Gantt-CgmovwIq.js";/* empty css                                              *//* empty css                                                              */const ye={class:"flex flex-col items-center justify-center mb-10"},ve={class:"text-1xl font-bold text-orange-800"},_e={class:"text-1xl font-bold text-orange-800"},ke={class:"flex justify-between"},we={key:1,class:"my-4"},he={class:"flex flex-row justify-between my-4 items-center gap-2"},De=["for"],je={class:"font-semibold"},Oe={key:0},Te={class:"my-1 p-2 border-color-identity-dark dark:border-gray-200"},Ie={class:"text-identity-dark font-semibold dark:text-gray-300"},Ne={key:1},Ae={key:2,class:"flex flex-row justify-center items-center my-4"},Ee={key:3,class:"my-4"},Se={class:"text-sm text-gray-500"},Ce={key:0,class:"flex flex-wrap transition-all duration-300 px-4 py-2"},Pe=["for"],Be={class:"text-center font-semibold"},He={class:"flex flex-row w-full mt-4"},Re={class:"flex flex-col w-1/2 pr-2"},Fe={class:"flex flex-row items-center px-3 py-1 rounded-lg mb-2 bg-orange-100 border border-orange-600"},Ve={class:"flex flex-col justify-center w-full"},$e={class:"text-sm text-center text-orange-800 dark:text-gray-300"},Le={class:"flex flex-row items-center px-3 py-1 rounded-lg mb-2 bg-orange-100 border border-orange-600"},Me={class:"flex flex-col justify-center w-full"},Ge={class:"text-sm text-center text-orange-800 dark:text-gray-300"},ze={class:"flex flex-row items-center px-3 py-1 rounded-lg bg-orange-100 border border-orange-600"},Je={class:"flex flex-col justify-center w-full"},Ue={class:"text-sm text-center text-orange-800 dark:text-gray-300"},qe={class:"flex flex-col w-1/2 pl-2"},Ke={class:"flex flex-col justify-center w-full"},Qe={class:"flex flex-row justify-center items-center"},We={class:"text-sm text-center dark:text-gray-300"},Xe={class:"flex flex-col justify-center w-full"},Ye={class:"flex flex-row justify-center items-center"},Ze={class:"text-sm text-center dark:text-gray-300"},et={class:"flex flex-col justify-center w-full"},tt={class:"flex flex-row justify-center items-center"},st={class:"text-sm text-center dark:text-gray-300"},ot={key:4,class:"flex flex-row justify-center items-center my-4"},kt={__name:"PlaneacionSugerida",setup(at){const R=de(),F=ce(),{formatPrettyDate:j,formatStoreDate:rt,parseStoreDate:f,isDateBetweenDates:nt,compareRangeDates:lt,addDaysToDate:it,compareDatesIsSame:V}=ue(),{formatHours:v,parseStringToIntHours:C,getResponsables:dt,getOrdenTrabajo:$,getOrdenTrabajoSkipingNotAvailableDates:ct,getOrdenEtapas:L,getOrdenEtapaTasks:ut,getOrdenEtapasGeneralTasks:xt,formatStringHours:pt,formatIntHours:gt,getLaboralHoursPerDay:mt,confirmSuggestedPlanning:M}=le(),G=u(["IconSave","IconBack"]),{iconsForm:_,loadFormIcons:z}=xe(),O=u(!1),k=u([]),J=u([]),w=u([]),p=u(null),U=P(()=>{var s,t,l,r,o,a;return((l=(t=(s=p.value)==null?void 0:s.estructura_proyecto)==null?void 0:t.proyecto)==null?void 0:l.codigo)+" - "+((a=(o=(r=p.value)==null?void 0:r.estructura_proyecto)==null?void 0:o.proyecto)==null?void 0:a.nombre_proyecto)}),q=P(()=>{var s,t,l,r,o,a;return((t=(s=p.value)==null?void 0:s.estructura_proyecto)==null?void 0:t.codigo_estructura)+" - "+((r=(l=p.value)==null?void 0:l.estructura_proyecto)==null?void 0:r.tipo_estructura.nombre)+" - "+((a=(o=p.value)==null?void 0:o.estructura_proyecto)==null?void 0:a.tipo_cimentacion.nombre)}),g=u([]),T=u(F.params.orden_id),h=u(!0),K=()=>{h.value=!h.value};pe(async()=>{O.value=!0,await z(G.value),await W(T.value),await X(T.value),await Q(p.value),O.value=!1});const Q=async s=>{g.value=JSON.parse(s.suggested_planning.tasks),console.log("Suggested Tasks: ",g.value)},W=async s=>{w.value=await L(s)},X=async s=>{const t=await $(s);p.value=t.ordenTrabajo,console.log("Orden de Trabajo: ",p.value),Y(t.responsablesOnOrderIncludingOwnNotAvailableDates),Z(t.responsablesOnOrderExcludingOwnNotAvailableDates)},Y=async s=>{k.value=s},Z=async s=>{J.value=s},ee=async s=>{te(s)&&(g.value=s,console.log("Las fechas son correctas",g.value),await M(T.value,g.value))},te=s=>se(s),se=s=>{let t=!0;const l=6,r=0;for(const o of s){let a=f(o.start);const m=f(o.end);for(;a<=m;){if(oe(o.responsables,a,o.no_available_days)&&a.getDay()!==l&&a.getDay()!==r){fe.fire({title:`El día ${j(a)} no está disponible para algunos de los responsables:
${o.responsables.map(N=>`• ${N.nombre_completo}`).join(`
`)}. 
 En la actividad: 
 [ ${o.task} ] `,icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#EC7522"}),t=!1;return}a.setDate(a.getDate()+1)}}return t},oe=(s,t,l)=>{const r=ae(l,t);return s.some(o=>o.fechas_no_disponibles.some(a=>{const m=f(a.start),N=f(a.end);return t>=m&&t<=N&&!r}))},ae=(s,t)=>{const o=f(t);return s.some(m=>V(f(m),o)&&o.getDay()!==6&&o.getDay()!==0)},re=s=>{console.log("openAddTaskModal data",s)},I=(s,t,l)=>({"text-red-800 bg-red-100 border border-red-600":y(s.etapa_id,t)>C(s[l]),"text-teal-800 bg-teal-100 border border-teal-600":y(s.etapa_id,t)<=C(s[l])}),y=(s,t)=>g.value.filter(o=>o.belongs_to_etapa===s).reduce((o,a)=>t==="etapa"||t==="ingenieria"&&a.area_responsable==="INGENIERIA"||t==="dibujo"&&a.area_responsable==="DIBUJO"?o+a.duration:o,0),ne=()=>{R.go(-1)};return(s,t)=>{const l=ge("VDropdown");return n(),i("main",null,[O.value?(n(),b(ie,{key:0})):A("",!0),e("div",ye,[t[0]||(t[0]=e("h1",{class:"text-2xl text-identity-dark dark:text-gray-300 mb-10"},"Planeación Sugerida",-1)),e("div",{class:x(["flex flex-row items-center px-3 py-1 rounded-lg my-1",["bg-orange-100 border border-orange-600"]])},[e("h1",ve,d(U.value),1)]),e("div",{class:x(["flex flex-row items-center px-3 py-1 rounded-lg my-1",["bg-orange-100 border border-orange-600"]])},[e("h1",_e,d(q.value),1)])]),e("div",ke,[e("button",{onClick:ne,class:x(["bg-identity-dark hover:bg-gray-700 dark:bg-orange-600 dark:hover:bg-orange-800 mb-2","flex items-center px-4 py-2 text-sm text-identity capitalize transition-colors duration-200 border rounded-md gap-x-2 dark:text-gray-200 dark:border-gray-200"])},[(n(),b(D(c(_).IconBack),{class:x(["w-5 h-5"])})),t[1]||(t[1]=e("span",null," Planeación ",-1))])]),t[15]||(t[15]=e("hr",null,null,-1)),k.value.length>0?(n(),i("div",we,[t[5]||(t[5]=e("div",{class:"flex justify-center items-center"},[e("span",{class:"text-black text-base font-bold"},"Responsables en la Orden de Trabajo")],-1)),e("div",he,[(n(!0),i(E,null,S(k.value,(r,o)=>(n(),i("div",{key:o,class:"flex flex-row items-center justify-center"},[e("label",{for:`responsable-checkbox-${o}`,class:"cursor-pointer text-sm font-medium text-gray-900 dark:text-gray-300 text-center border-color-identity-dark rounded-lg p-2 shadow-lg"},[e("span",je,d(r.nombre_completo),1),r.fechas_no_disponibles.length>0?(n(),i("div",Oe,[me(l,{triggers:["click"],placement:"top"},{popper:B(()=>[(n(!0),i(E,null,S(r.fechas_no_disponibles,(a,m)=>(n(),i("div",{key:m,class:"basis-full text-sm font-normal text-center rtl:text-right text-identity dark:text-gray-300 gap-4"},[e("div",Te,[e("span",Ie,[t[3]||(t[3]=H(" • ",-1)),e("strong",null,d(a.type)+" : ",1),H(" "+d(c(j)(a.start))+" - "+d(c(j)(a.end))+" | "+d(c(v)(a.busy_time)),1)])])]))),128))]),default:B(()=>[e("div",{class:x(["flex flex-row justify-center items-center",["m-1 p-2 rounded-md shadow-xl","bg-cyan-100 border border-cyan-600","custom-shadow"]])},[t[2]||(t[2]=e("span",null,"Fechas No Disponibles: ",-1)),(n(),b(D(c(_).IconCalendar),{class:x(["ml-2","w-5 h-5","text-cyan-800"])}))])]),_:2},1024)])):(n(),i("div",Ne,t[4]||(t[4]=[e("div",{class:"inline-flex items-center px-3 py-1 rounded-full gap-x-2 bg-green-100 border border-green-600"},[e("h2",{class:"text-sm font-semibold text-green-800"}," 100% Disponible. ")],-1)])))],8,De)]))),128))])])):(n(),i("div",Ae,t[6]||(t[6]=[e("div",{class:"inline-flex items-center px-3 py-1 rounded-full gap-x-2 bg-cyan-100 border border-cyan-600"},[e("h2",{class:"text-sm font-semibold text-cyan-800"}," No hay responsables para mostrar. ")],-1)]))),w.value.length>0?(n(),i("div",Ee,[e("div",{class:"flex justify-center items-center py-4 px-10 text-center cursor-pointer rounded-lg border border-gray-600 shadow-lg gap-4",onClick:K},[t[7]||(t[7]=e("div",{class:"flex justify-center items-center cursor-pointer"},[e("span",{class:"text-gray-900 dark:text-gray-300 text-base font-bold"},"Información General Etapas")],-1)),e("span",Se,[h.value?(n(),b(D(c(_).IconArrowDown),{key:0,class:"h-6 w-6"})):(n(),b(D(c(_).IconArrowUp),{key:1,class:"h-6 w-6"}))])]),h.value?A("",!0):(n(),i("div",Ce,[(n(!0),i(E,null,S(w.value,(r,o)=>(n(),i("div",{key:o,class:"flex flex-col justify-center items-center w-1/4 p-2 box-border border-r border-b border-solid border-black"},[e("label",{for:`etapa-checkbox-${o}`,class:"cursor-pointer text-sm font-medium text-gray-900 dark:text-gray-300"},[e("span",Be,d(r.show_data),1)],8,Pe),e("div",He,[e("div",Re,[e("div",Fe,[e("div",Ve,[t[8]||(t[8]=e("h2",{class:"text-sm text-center text-orange-800 dark:text-gray-300"}," Horas Estimadas Etapa: ",-1)),e("h2",$e,d(r.horas_estimadas_etapa),1)])]),e("div",Le,[e("div",Me,[t[9]||(t[9]=e("h2",{class:"text-sm text-center text-orange-800 dark:text-gray-300"}," Horas Estimadas Ingeniería: ",-1)),e("h2",Ge,d(r.horas_estimadas_ingenieria),1)])]),e("div",ze,[e("div",Je,[t[10]||(t[10]=e("h2",{class:"text-sm text-center text-orange-800 dark:text-gray-300"}," Horas Estimadas Dibujo: ",-1)),e("h2",Ue,d(r.horas_estimadas_dibujo),1)])])]),e("div",qe,[e("div",{class:x(["flex flex-row items-center px-3 py-1 rounded-lg mb-2",I(r,"etapa","horas_estimadas_etapa")])},[e("div",Ke,[t[11]||(t[11]=e("h2",{class:"text-sm text-cente"}," Tiempo Planeado Etapa: ",-1)),e("div",Qe,[e("h2",We,d(c(v)(y(r.etapa_id,"etapa"))),1)])])],2),e("div",{class:x(["flex flex-row items-center px-3 py-1 rounded-lg mb-2",I(r,"ingenieria","horas_estimadas_ingenieria")])},[e("div",Xe,[t[12]||(t[12]=e("h2",{class:"text-sm text-center"}," Tiempo Planeado Ingeniería: ",-1)),e("div",Ye,[e("h2",Ze,d(c(v)(y(r.etapa_id,"ingenieria"))),1)])])],2),e("div",{class:x(["flex flex-row items-center px-3 py-1 rounded-lg",I(r,"dibujo","horas_estimadas_dibujo")])},[e("div",et,[t[13]||(t[13]=e("h2",{class:"text-sm text-center"}," Tiempo Planeado Dibujo: ",-1)),e("div",tt,[e("h2",st,d(c(v)(y(r.etapa_id,"dibujo"))),1)])])],2)])])]))),128))]))])):(n(),i("div",ot,t[14]||(t[14]=[e("div",{class:"inline-flex items-center px-3 py-1 rounded-full gap-x-2 bg-cyan-100 border border-cyan-600"},[e("h2",{class:"text-sm font-semibold text-cyan-800"}," No hay etapas para mostrar ")],-1)]))),t[16]||(t[16]=e("hr",null,null,-1)),e("div",null,[g.value.length>0?(n(),b(be,{key:0,tasks:g.value,"etapas-on-order":w.value,"responsables-on-order":k.value,"show-general-info-suggested-planning":!0,onApplyChanges:ee,onOpenModal:re},null,8,["tasks","etapas-on-order","responsables-on-order"])):A("",!0)])])}}};export{kt as default};
