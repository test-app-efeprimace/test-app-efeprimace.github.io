import{s as T,j as Y,b as Z,q as V,r as u,x as ee,N as j,m as D,O as te,c as l,o as s,g as v,d as f,a as o,F as b,y as g,p as x,h as m,z as _,t as C,e as O,Q as q,A as ae,i as se}from"./index-Ficy73Kv.js";import{u as re,A as oe}from"./business-BrTkWtTt.js";const le={class:"flex flex-wrap justify-center items-center w-full my-4"},ne=["onClick"],ce={key:0,class:"mx-1 text-sm sm:text-base"},ie={class:"flex flex-row items-end justify-center my-8 gap-4"},ue={class:"flex flex-row items-center"},de={for:"projects",class:"block text-sm text-identity-dark dark:text-gray-300 max-w-full"},pe={class:"flex flex-row max-w-full"},me={key:0,class:"relative flex h-2 w-2 mt-1.5 max-w-full"},he={class:"ml-1 max-w-full truncate"},ve={class:"basis-1/12 flex justify-center"},fe=["disabled"],ye={key:1},be={key:0,class:"chart-wrapper flex flex-wrap p-2"},ge={key:0,class:"flex flex-col justify-center items-center"},xe={class:"my-2 inline-flex items-center px-3 py-1 rounded-full gap-x-2 bg-green-100 border border-green-600"},_e={class:"text-sm font-semibold text-green-800"},Ce={key:1,class:"flex flex-col justify-center items-center"},ke={class:"my-2 inline-flex items-center px-3 py-1 rounded-full gap-x-2 bg-green-100 border border-green-600"},we={class:"text-sm font-semibold text-green-800"},Be={__name:"Dashboard",setup(je){const{isDarkMode:I,isMobile:M}=T(Y()),{userAuth:Ie}=T(Z()),{iconsForm:S,loadFormIcons:N}=V(),E=u(["IconOccupation","IconProject","IconArea","IconCharge","IconProfile","IconLineChart","IconCalendar","IconBarChart","IconPieChart","IconUsers","IconSearch"]),{components:A,loadComponents:F,getListProyectos:L,getEstructurasProyectoActivas:W,fetchDataTabDashboard:G}=re();ee(async()=>{await N(E.value),await F(R.value),await U()});const n=u(0),k=u(!1),w=u([{name:"projects",label:"Proyectos",type:"tag",placeholder:"Selecciona uno o más proyectos",required:!0,disabled:!1,options:[]},{name:"structures",label:"Estructuras",type:"tag",placeholder:"Selecciona uno o más estructuras",required:!0,disabled:!1,options:[]}]),r=u({}),U=async()=>{const e=await L(),a=w.value.find(d=>d.name==="projects");a.options=[...e]},z=async e=>{if(!e||e.length===0)return;let a=[];for(const t of e){const c=await W(t.id);a=[...a,...c]}const d=w.value.find(t=>t.name==="structures");d.options=a};j(()=>r.value.projects,(e,a)=>{(e==null?void 0:e.length)>0&&z(r.value.projects)},{immediate:!1});const R=u([{name:"BaseTable",folder:"tables"},{name:"BaseForm",folder:"forms"},{name:"SimpleBarChart",folder:"charts"},{name:"SimplePieChart",folder:"charts"},{name:"SimpleColumnChart",folder:"charts"},{name:"GroupedBarChart",folder:"charts"},{name:"GroupedColumnChart",folder:"charts"},{name:"AdvancedTimelineChart",folder:"charts"},{name:"BarChartWithMarkets",folder:"charts"},{name:"BarChartWithNegativeValues",folder:"charts"},{name:"ColumnChartWithMarkets",folder:"charts"}]),h=u({}),i=u([{name:"equipos",title:"Equipos",icon:"IconUsers",type:"BaseTable",table:"equipos"},{name:"fechas_entrega",title:"Fechas de entrega",icon:"IconCalendar",type:"BarChartWithMarkets"},{name:"avance_proyectos",title:"Avance Proyectos",icon:"IconPieChart",type:"SimplePieChart"},{name:"avance_estructuras",title:"Avance Estructuras",icon:"IconBarChart",type:"GroupedColumnChart"},{name:"avance_etapas",title:"Avance Etapas",icon:"IconLineChart",type:"GroupedBarChart"},{name:"cumplimiento_actividades",title:"Cumplimiento Actividades",icon:"IconBarChart",type:"ColumnChartWithMarkets"},{name:"ocupacion_personal",title:"Ocupación Personal",icon:"IconOccupation",type:"AdvancedTimelineChart"}]);j(()=>r.value.projects,e=>{(e==null?void 0:e.length)>0&&(r.value.structures=r.value.structures&&r.value.structures.length>0?r.value.structures.filter(a=>e.some(d=>d.id===a.proyecto_id)):[]),(e==null?void 0:e.length)===0&&(r.value.structures=[])},{immediate:!1});const $=e=>{var a;return e==="structures"&&(!r.value.projects||((a=r.value.projects)==null?void 0:a.length)===0)},B=D(()=>!r.value.projects||r.value.projects.length===0||(!r.value.structures||r.value.structures.length===0)&&P.value);j(n,(e,a)=>{h.value[i.value[e].name]=[],h.value[i.value[a].name]=[]});const Q=async()=>{try{if(y(!0),i.value[n.value].name==="equipos"){h.value[i.value[n.value].name]=r.value.projects,y(!1);return}const e=await G(i.value[n.value].name,r.value);console.log("Respuesta de la API:",e.data),h.value[i.value[n.value].name]=e.data,setTimeout(()=>{y(!1)},1e3)}catch(e){console.error("Error al aplicar los filtros:",e),y(!1)}},H=e=>e==="structures"?P.value:!0,J=["avance_estructuras","avance_etapas"],P=D(()=>J.includes(i.value[n.value].name)),K=e=>h.value[e].length>0,y=e=>{k.value=e};return(e,a)=>{const d=te("multiselect");return s(),l("main",null,[k.value?(s(),v(oe,{key:0})):f("",!0),a[4]||(a[4]=o("div",{class:"wrapper flex items-center justify-center mb-10"},[o("h1",{class:"text-2xl text-identity-dark dark:text-gray-300"},"Dashboard")],-1)),o("div",le,[(s(!0),l(b,null,g(i.value,(t,c)=>(s(),l("button",{onClick:p=>n.value=c,class:x(["inline-flex items-center justify-center h-12 px-2 py-2 text-center sm:px-4 rounded-t-md dark:text-white whitespace-nowrap focus:outline-none w-1/4",[n.value===c?m(I)?"bg-orange-700 text-gray-300":"bg-identity-dark text-identity":m(I)?"text-gray-300":"text-identity-dark",n.value===c?"border border-b-0":"border-b"]])},[(s(),v(_(m(S)[t.icon]),{class:"w-6 h-6 mx-1"})),m(M)?f("",!0):(s(),l("span",ce,C(t.title),1))],10,ne))),256))]),o("div",ie,[(s(!0),l(b,null,g(w.value,(t,c)=>O((s(),l("div",{key:c,class:"basis-1/3"},[o("div",ue,[o("label",de,[o("div",pe,[t.required?(s(),l("span",me,a[1]||(a[1]=[o("span",{class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"},null,-1),o("span",{class:"relative inline-flex rounded-full h-2 w-2 bg-red-500"},null,-1)]))):f("",!0),o("span",he,C(t.label)+" :",1)])])]),t.type==="tag"?(s(),v(d,{key:0,id:t.name,modelValue:r.value[t.name],"onUpdate:modelValue":p=>r.value[t.name]=p,"tag-placeholder":"Nuevo tag",placeholder:t.placeholder,"selected-label":"Seleccionado","select-label":"Seleccionar","deselect-label":"Deseleccionar","track-by":"id",options:t.options,multiple:!0,taggable:!1,disabled:$(t.name),label:"show_data"},{noResult:ae(()=>a[2]||(a[2]=[se(" No hay resultados ",-1)])),_:2},1032,["id","modelValue","onUpdate:modelValue","placeholder","options","disabled"])):f("",!0)])),[[q,H(t.name)]])),128)),o("div",ve,[o("button",{onClick:a[0]||(a[0]=t=>Q()),disabled:B.value,class:x(["flex gap-1 px-4 py-3 text-sm text-identity capitalize transition-colors duration-200 border rounded-md dark:text-gray-200 dark:border-gray-200",["bg-identity-dark hover:bg-gray-700 dark:bg-orange-600 dark:hover:bg-orange-800",B.value?"opacity-50 cursor-not-allowed":""]])},[a[3]||(a[3]=o("span",null," Aplicar ",-1)),(s(),v(_(m(S).IconSearch),{class:x(["w-5 h-5"])}))],10,fe)])]),k.value?f("",!0):(s(),l("div",ye,[(s(!0),l(b,null,g(i.value,(t,c)=>(s(),l("div",{key:c,class:"tab-container"},[n.value===c?(s(),l("div",be,[(s(!0),l(b,null,g(h.value[t.name],(p,X)=>O((s(),l("div",{key:X,class:x(["basis-1/2",[t.name!=="equipos"?"border-color-identity-dark-gold rounded-lg p-4":""]])},[t.type==="BaseTable"?(s(),l("div",ge,[o("div",xe,[o("span",_e,C(p.show_data),1)]),(s(),v(_(m(A)[t.type]),{table:t.table,"icons-view":[],"show-search":!1,"row-selected":p},null,8,["table","row-selected"]))])):(s(),l("div",Ce,[o("div",ke,[o("span",we,C(p.name),1)]),(s(),v(_(m(A)[t.type]),{data:p.data},null,8,["data"]))]))],2)),[[q,K(t.name)]])),128))])):f("",!0)]))),128))]))])}}};export{Be as default};
